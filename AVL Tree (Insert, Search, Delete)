#include <stdio.h>
#include <stdlib.h>
struct node 
{
    int key, height;
    struct node *l,*r;
};
int height(struct node *n){ return n?n->height:0; }
int max(int a,int b){ return a>b?a:b; }

struct node* newNode(int k){
    struct node* n=(struct node*)malloc(sizeof(struct node));
    n->key=k; n->l=n->r=NULL; n->height=1;
    return n;
}

struct node* rightRotate(struct node* y){
    struct node* x=y->l;
    y->l=x->r;
    x->r=y;
    y->height=max(height(y->l),height(y->r))+1;
    x->height=max(height(x->l),height(x->r))+1;
    return x;
}

struct node* leftRotate(struct node* x){
    struct node* y=x->r;
    x->r=y->l;
    y->l=x;
    x->height=max(height(x->l),height(x->r))+1;
    y->height=max(height(y->l),height(y->r))+1;
    return y;
}

int getBalance(struct node* n){
    return n?height(n->l)-height(n->r):0;
}

struct node* insert(struct node* n,int k){
    if(!n) return newNode(k);
    if(k<n->key) n->l=insert(n->l,k);
    else if(k>n->key) n->r=insert(n->r,k);
    else return n;

    n->height=1+max(height(n->l),height(n->r));
    int b=getBalance(n);

    if(b>1 && k<n->l->key) return rightRotate(n);
    if(b<-1 && k>n->r->key) return leftRotate(n);
    if(b>1 && k>n->l->key){ n->l=leftRotate(n->l); return rightRotate(n); }
    if(b<-1 && k<n->r->key){ n->r=rightRotate(n->r); return leftRotate(n); }
    return n;
}

void inorder(struct node* r){
    if(r){ inorder(r->l); printf("%d ",r->key); inorder(r->r); }
}

int main(){
    struct node* root=NULL;
    int n,i,x;
    printf("Enter number of nodes: ");
    scanf("%d",&n);
    for(i=0;i<n;i++){
        scanf("%d",&x);
        root=insert(root,x);
    }
    printf("Inorder: ");
    inorder(root);
    return 0;
}
